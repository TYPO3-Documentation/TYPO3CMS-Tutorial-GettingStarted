.. include:: /Includes.rst.txt

.. index:: tuning

.. _tunetypo3:

=============
Наладка TYPO3
=============

В этой главе представлена информация о настройке и оптимизации инфраструктуры, на которой работает TYPO3.

OPcache
=======

Рекомендуется включить OPcache на веб-сервере, на котором работает TYPO3. Настройки OPcache по умолчанию обеспечивают значительный прирост производительности, однако есть некоторые коррективы, которые помогут еще больше повысить стабильность и производительность. Кроме того, включение некоторых функций OPcache может привести к снижению производительности.

Включение OPcache
-----------------

.. code-block:: ini
  :caption: php.ini

  opcache.enable=1
  opcache.revalidate_freq=30
  opcache.revalidate_path=0

Доработка OPcache
-----------------

Ниже приведен список функций OPcache с информацией о том, как они могут влиять на производительность TYPO3.

.. confval:: opcache.save_comments

 :Default: 1
 :Recommended: 1

 Установка значения 0 может повысить производительность, но некоторые части TYPO3 (включая Extbase) для правильной работы полагаются на информацию, хранящуюся в комментариях phpDoc.

.. confval:: opcache.use_cwd

 :Default: 1
 :Recommended: 1

 Установка значения 0 может вызвать проблемы в некоторых приложениях, поскольку файлы с одинаковыми названиями могут быть смешаны из-за того, что полный путь к файлу не сохраняется в качестве ключа. TYPO3 работает с абсолютными путями, поэтому это не приведет к улучшению производительности.

.. confval:: opcache.validate_timestamps

 :Default: 1
 :Recommended: 1

 Хотя установка этого значения в 0 может ускорить работу, вы **должны** убедиться, что opcache очищается при каждом изменении PHP-скриптов, иначе они не будут обновляться в OPcache. Достичь этого можно с помощью правильного конвейера развертывания. Кроме того, некоторые файлы могут быть добавлены в черный список, подробнее об этом см. в разделе `opcache.blacklist_filename`.

.. confval:: opcache.revalidate_freq

 :Default: 2
 :Recommended: 30

 Установка этого значения в большую величину может повысить производительность, но при этом возникает та же проблема, что и при установке `validate_timestamps` в 0.

.. confval:: opcache.revalidate_path

 :Default: 1
 :Recommended: 0

 Установка этого значения в 0 безопасна для TYPO3. Однако это может стать проблемой, если для загрузки скриптов используются значения относительных путей, а также если один и тот же файл несколько раз встречается в пути включения.

.. confval:: opcache.max_accelerated_files

 :Default: 10000
 :Recommended: 10000

 Установки по умолчанию должно быть достаточно для TYPO3, но это зависит от количества дополнительных скриптов, которые должны быть загружены системой.

Дополнительную информацию об OPcache можно найти в `Официальной документации по PHP <https://www.php.net/manual/en/opcache.configuration.php>`__.

